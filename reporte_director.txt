================================================================================
REPORTE TÃ‰CNICO Y FUNCIONAL: ESTADO DEL DIRECTOR DE ESCENA (V3.3)
FECHA: 20 Enero 2026
AUTOR: Jules (Sistemas)
PARA: Arquitecto del Proyecto
================================================================================

1. ANÃLISIS DE SITUACIÃ“N ACTUAL
--------------------------------------------------------------------------------
Usted percibe al Director de Escena como "solo un chatbot" porque, en efecto, el 90% de su interfaz visible actual es la ventana de chat (`DirectorPanel.tsx`). Sin embargo, bajo el capÃ³ existe una arquitectura diseÃ±ada para ser mucho mÃ¡s que eso, pero que actualmente estÃ¡ "dormida" o es invisible al usuario por decisiones de diseÃ±o UI.

A continuaciÃ³n detallo cÃ³mo funciona realmente y por quÃ© no estÃ¡ viendo el resto.

1.1 FUNCIONAMIENTO TÃ‰CNICO ACTUAL (LO QUE EL CÃ“DIGO HACE)
El componente `DirectorPanel.tsx` opera bajo dos modalidades:

A. MODALIDAD ACTIVA (CHAT):
   - Conecta con la Cloud Function `chatWithGem`.
   - Inyecta un "System Instruction" especÃ­fico: "ACT AS: Director of Photography and Narrative Structure".
   - Tiene memoria de sesiÃ³n (guarda el historial en Firestore `users/{uid}/forge_sessions`).
   - Es reactivo: Solo hace algo si usted le escribe.

B. MODALIDAD PASIVA (MONITOR DE DRIFT / ECOS):
   - Cuando usted abre el panel, `App.tsx` dispara silenciosamente la funciÃ³n `scanProjectDrift`.
   - Esta funciÃ³n compara los vectores de su proyecto actual con un "Centroide" (el promedio matemÃ¡tico de su estilo y trama).
   - SI (y solo si) detecta una desviaciÃ³n grave (> 70% de incoherencia), devuelve una lista de "Alertas de Drift".
   - El Director recibe estas alertas vÃ­a `props` (`driftAlerts`) e inyecta tarjetas rojas en el chat con botones "Purgar" (Borrar memoria) o "Rescatar" (Marcar conflicto).

1.2 Â¿POR QUÃ‰ "SOLO VEO UN CHAT"? (EL DIAGNÃ“STICO)
Existen tres razones tÃ©cnicas por las que no ve la funcionalidad avanzada:
1. **Silencio por Estabilidad:** Si su proyecto es coherente (Drift < 0.7), el sistema no devuelve nada. No hay un mensaje de "Todo en orden, Director monitoreando". El panel se ve vacÃ­o.
2. **Dependencia del Centroide:** Si no ha ejecutado una indexaciÃ³n completa recientemente (`indexTDB`), no existe un "Centroide" contra el cual comparar. El escÃ¡ner falla silenciosamente y no muestra nada.
3. **DesconexiÃ³n de Herramientas:** El Director no tiene botones para invocar las herramientas que ya existen en el backend (El Inspector, El Tribunal, La Bola de Cristal). EstÃ¡n aisladas en otros paneles o sin interfaz.

--------------------------------------------------------------------------------
2. INVENTARIO DE CAPACIDADES "DORMIDAS" (BACKEND)
--------------------------------------------------------------------------------
He analizado `index.ts` y `guardian.ts`. Su backend tiene superpoderes que el Director no estÃ¡ usando. Estas funciones estÃ¡n listas para conectarse:

A. `forgeAnalyzer` (EL INSPECTOR)
   - **QuÃ© hace:** Lee un capÃ­tulo, extrae automÃ¡ticamente todos los personajes, detecta si son nuevos ("Ghosts") o existentes, y genera un reporte de continuidad.
   - **Estado:** âœ… Backend listo / âŒ Sin botÃ³n en el Director.
   - **Potencial:** El Director podrÃ­a tener un botÃ³n "Analizar Elenco del CapÃ­tulo" que ejecute esto y le diga: "Oye, mencionaste a 'Zorg' pero no tiene ficha. Â¿La creo?".

B. `enrichCharacterContext` (LA BOLA DE CRISTAL)
   - **QuÃ© hace:** Realiza una bÃºsqueda profunda (RAG) sobre un personaje para reconstruir su vida entera basada en fragmentos dispersos.
   - **Estado:** âœ… Backend listo / âŒ Oculto en lÃ³gica interna.
   - **Potencial:** Usted podrÃ­a preguntar al Director: "Â¿QuÃ© sabemos realmente de Ana?" y Ã©l usarÃ­a esto para darle un dossier psicolÃ³gico completo, no solo chatear.

C. `summonTheTribunal` (EL JUICIO RÃPIDO)
   - **QuÃ© hace:** Invoca a tres IAs (Arquitecto, Bardo, Hater) para criticar un texto.
   - **Estado:** âœ… Tiene su propio panel / âŒ Desconectado del Director.
   - **Potencial:** El Director podrÃ­a tener un "Modo CrÃ­tico" que use esta funciÃ³n para darle feedback inmediato sobre el pÃ¡rrafo seleccionado sin salir del chat.

D. `rescueEcho` / `purgeEcho` (GESTIÃ“N DE MEMORIA)
   - **QuÃ© hace:** Micro-cirugÃ­a en la base de datos vectorial.
   - **Estado:** âœ… Implementado en UI de Drift.
   - **Problema:** Solo aparece en emergencias. DeberÃ­a poder invocarse manualmente para limpiar "alucinaciones" de la IA.

--------------------------------------------------------------------------------
3. SUGERENCIAS DE EVOLUCIÃ“N (ROADMAP TÃ‰CNICO)
--------------------------------------------------------------------------------
Para transformar al Director de un "Chatbot" a un verdadero "Gerente de Escena", sugiero implementar los siguientes cambios en el cÃ³digo (`DirectorPanel.tsx`):

3.1 UX: VISIBILIDAD DE ESTADO (MONITOR ACTIVO)
   - **Cambio:** AÃ±adir una barra de estado superior ("HUD") en el panel.
   - **FunciÃ³n:** Mostrar visualmente el nivel de "Drift" actual (ej: un medidor de 0% a 100%) incluso si es bajo.
   - **Efecto:** Usted verÃ¡ que el Director estÃ¡ "trabajando" y vigilando, no solo esperando texto. Si el Centroide falta, mostrarÃ¡ una alerta amarilla "CalibraciÃ³n Necesaria".

3.2 UX: COMANDOS RÃPIDOS (SLASH COMMANDS O BOTONES)
   - Integrar las funciones dormidas directamente en el input del chat o como botones sobre Ã©l:
   - `[ðŸ” Analizar Escena]`: Invoca a `forgeAnalyzer` sobre el texto visible. Muestra reporte de personajes en el chat.
   - `[âš–ï¸ Juicio RÃ¡pido]`: Invoca a `summonTheTribunal` para el pÃ¡rrafo actual.
   - `[ðŸ§  Recordar Contexto]`: Fuerza una actualizaciÃ³n de la memoria inmediata.

3.3 INTELIGENCIA PROACTIVA (EL "SEGUNDO CEREBRO")
   - Modificar `scanProjectDrift` para que no solo busque errores, sino "Oportunidades".
   - Ejemplo: Si detecta que un personaje no ha aparecido en 10 capÃ­tulos, el Director deberÃ­a sugerir: "Nota: El personaje X lleva mucho tiempo inactivo. Â¿Es intencional?".

3.4 INTEGRACIÃ“N CON EL EDITOR
   - Permitir que el Director subraye texto en el editor (`HybridEditor`) cuando detecta un problema (usando los `driftMarkers` que ya vi en `App.tsx` pero que solo son simulados actualmente).

--------------------------------------------------------------------------------
CONCLUSIÃ“N
--------------------------------------------------------------------------------
El Director no estÃ¡ "roto", estÃ¡ **incompleto en su interfaz**. El cerebro (Backend) es de nivel Titan, pero el cuerpo (Frontend) es de nivel BÃ¡sico. Conectar las tuberÃ­as existentes (`forgeAnalyzer`, `enrichCharacterContext`) a la UI del Director cambiarÃ¡ radicalmente la experiencia de "Chat pasivo" a "Centro de Mando Activo".
