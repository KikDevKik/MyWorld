游 INSTRUCCIONES PARA LA FASE 3: EL CEREBRO (ACTIVACI칍N DEL RAG)

Hola Jules,

La Fase 2 (Refactorizaci칩n y Limpieza) ha sido completada con 칠xito. El tablero est치 limpio y aislado contextualmente. Ahora es momento de conectar la inteligencia real.

游꿢 OBJETIVO PRINCIPAL:
Convertir el chat de la Forja (ForgeChat.tsx) de un simple asistente reactivo en un "Or치culo de la Historia". Debe ser capaz de responder preguntas sobre el lore profundo que no est치 visible en pantalla, utilizando la base de conocimientos vectorial.

丘뙖잺 TAREAS T칄CNICAS:

1.  **Conexi칩n Vectorial (TDB_Index):**
    -   Habilitar la b칰squeda en la colecci칩n/칤ndice `TDB_Index` de Firestore/Vector Store.
    -   Cuando el usuario haga una pregunta en `ForgeChat`, el sistema no solo debe mirar el historial del chat, sino realizar una b칰squeda sem치ntica (RAG) para recuperar fragmentos relevantes.

2.  **Contexto Din치mico (Chunks):**
    -   Implementar la inyecci칩n de "Chunks" (fragmentos de texto procesados) en el prompt del sistema.
    -   Ejemplo de caso de uso: Si el usuario pregunta "쯇or qu칠 Anna odia el puente?", el sistema debe recuperar los p치rrafos de cap칤tulos anteriores donde se menciona el evento del puente y usarlos para generar la respuesta.

3.  **Integraci칩n con 'The Builder' (Scopeado):**
    -   Reutilizar o adaptar la l칩gica de `builder.ts` (Cloud Function) para gestionar estas consultas.
    -   **CR칈TICO:** Asegurar que el contexto se restrinja a la SAGA ACTIVA (o carpetas designadas como Canon de esta saga). Evitar "contaminaci칩n cruzada" de otras historias a menos que se solicite expl칤citamente.
    -   El `folderId` o `scope` actual de la Forja debe pasarse como filtro estricto a la funci칩n de b칰squeda vectorial.

4.  **UX del Pensamiento:**
    -   Considerar mostrar visualmente que la IA est치 "Consultando los Archivos" o "Leyendo el Canon" antes de responder, para dar feedback de que est치 ocurriendo un proceso RAG.

游늭 ARCHIVOS IMPACTADOS (Estimados):
-   `src/components/forge/ForgeChat.tsx` (Frontend)
-   `functions/src/builder.ts` (Backend - o nueva funci칩n espec칤fica para Forge)
-   `src/hooks/useForgeChat.ts` (si existe, o l칩gica de hook de chat)

丘멆잺 NOTA:
Esta fase es puramente l칩gica y de backend/integraci칩n. La UI no deber칤a cambiar dr치sticamente, salvo por indicadores de estado ("Pensando...", "Consultando Canon...").

춰Proceda con la activaci칩n sin치ptica, Comandante! 游
