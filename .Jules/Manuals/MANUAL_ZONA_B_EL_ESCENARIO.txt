ğŸ­ ZONA B: EL ESCENARIO (ACTION)
El espacio sagrado donde el caos se transmuta en orden. Donde la creatividad toma forma fÃ­sica.

--------------------------------------------------------------------------------
1. EL EDITOR HÃBRIDO (Hybrid Editor)
La Promesa: Un lienzo que respira. Un editor de texto vivo que entiende la estructura de tu universo y te protege contra la incoherencia.

MecÃ¡nica Sagrada (CÃ³mo se usa):
1. Escritura Zen: Escribe libremente. El editor soporta Markdown estÃ¡ndar (negritas, cursivas, encabezados).
2. Candado de Lectura: Si ves un candado rojo en la esquina, estÃ¡s en modo "Solo Lectura" (archivo bloqueado por otro sistema o usuario).
3. Decoraciones de Deriva: Ocasionalmente, verÃ¡s lÃ­neas subrayadas en colores (Rojo/Naranja). Son las marcas del "Drift Plugin", seÃ±ales de que la IA ha detectado una incoherencia narrativa.

La Magia Oculta (Lo TÃ©cnico): Basado en CodeMirror 6, el HybridEditor.tsx inyecta extensiones personalizadas (driftExtension, titaniumTheme).
â€¢ Compartimentos de Estado: Usa Compartment para reconfigurar dinÃ¡micamente si el editor es editable o readOnly sin destruir el estado.
â€¢ SincronizaciÃ³n: Detecta cambios externos y reemplaza el contenido solo si hay divergencia significativa, evitando bucles de renderizado con el autoguardado.

Advertencias:
â€¢ âš ï¸ Cursor Fantasma: Si colaboras en tiempo real, el sistema prioriza la Ãºltima escritura ("Last Write Wins"). AÃºn no hay cursores colaborativos multijugador.

--------------------------------------------------------------------------------
2. LA BARRA DE ESTADO (Status Bar)
La Promesa: El pulso vital de tu sesiÃ³n. Mantiene tus metas diarias y la vigilancia del Canon a simple vista, sin estorbar.

MecÃ¡nica Sagrada (CÃ³mo se usa):
1. Metricas: Observa tu conteo de palabras y tiempo de lectura estimado (~200 palabras/min).
2. El Ojo de Argos: Un botÃ³n que muestra el estado del GuardiÃ¡n (Limpio/Conflicto/Escaneando). PÃºlsalo para forzar una auditorÃ­a.
3. La Joya (Progreso): Una barra de energÃ­a que se llena conforme escribes. Haz clic en el engranaje para ajustar tu Meta Diaria (por defecto 1000 palabras) o reiniciar el contador.

La Magia Oculta (Lo TÃ©cnico): El componente StatusBar.tsx calcula el "Delta" de palabras en tiempo real.
â€¢ HeurÃ­stica Anti-Pegado: Ignora saltos bruscos (>50 palabras en un tick) para evitar que copiar y pegar texto infle falsamente tu progreso diario.
â€¢ Persistencia: Guarda tu progreso y meta en localStorage (myword_daily_goal, myword_daily_YYYY-MM-DD).

Advertencias:
â€¢ âš ï¸ Reinicio: El progreso se reinicia visualmente cada dÃ­a, pero no se borra el historial. Si cambias de dispositivo, el progreso local no se transfiere (es client-side).

--------------------------------------------------------------------------------
3. LA FORJA DE ALMAS (Forge Panel)
La Promesa: El taller del Demiurgo. Crea, edita y consulta las fichas de tus personajes sin salir de la inmersiÃ³n.

MecÃ¡nica Sagrada (CÃ³mo se usa):
1. VinculaciÃ³n: Al abrirla por primera vez, te pedirÃ¡ "Crear BÃ³veda" (carpeta automÃ¡tica /Personajes) o "Vincular Existente".
2. Dashboard: Visualiza tarjetas de tus personajes.
3. DesvinculaciÃ³n: Si necesitas cambiar la carpeta fuente, usa el botÃ³n de "Romper Enlace" (icono cadena rota) en la cabecera.

La Magia Oculta (Lo TÃ©cnico): ForgePanel.tsx actÃºa como un puente entre Firestore (ProjectConfig) y Google Drive.
â€¢ ResoluciÃ³n HÃ­brida: Si la configuraciÃ³n tiene un characterVaultId, la Forja intenta resolver su nombre via API de Drive. Si falla (offline), usa una cachÃ© local o un nombre genÃ©rico ("BÃ³veda de Personajes").
â€¢ Recursividad: Al seleccionar una carpeta, la Forja leerÃ¡ todos los personajes dentro, incluso en subcarpetas profundas.

Advertencias:
â€¢ âš ï¸ Movimientos FÃ­sicos: Si mueves la carpeta de Personajes en Drive a otro lugar fuera del proyecto, la Forja perderÃ¡ el rastro y tendrÃ¡s que volver a vincularla.

--------------------------------------------------------------------------------
4. PERFORADOR DE MUNDOS (Nexus Canvas V2)
La Promesa: Ver lo invisible. Un mapa neuronal interactivo que revela las conexiones ocultas entre todas las entidades de tu universo.

MecÃ¡nica Sagrada (CÃ³mo se usa):
1. NavegaciÃ³n: Arrastra para moverte (Pan), rueda el ratÃ³n para Zoom.
2. El Ojo del Nexus: Pulsa el botÃ³n central "NEXUS" para escanear todo tu proyecto en busca de nuevas entidades.
3. CristalizaciÃ³n: Si ves un "Fantasma" (nodo translÃºcido), haz clic para "Cristalizarlo" (crear su archivo oficial en Drive).
4. Protocolo de IncineraciÃ³n: En la barra inferior, el botÃ³n de "Limpiar Todo" borra la base de datos visual para empezar de cero (Ãºtil tras refactorizaciones masivas).

La Magia Oculta (Lo TÃ©cnico): Un motor grÃ¡fico avanzado (WorldEnginePageV2.tsx) impulsado por react-zoom-pan-pinch y framer-motion.
â€¢ Nodos Fantasma: Entidades detectadas en el texto pero que aÃºn no tienen archivo (isGhost: true). Viven en localStorage (nexus_drafts_v1) hasta que las cristalizas.
â€¢ Identidad Determinista: Los IDs de los nodos se generan matemÃ¡ticamente (DJB2 Hash) basados en el nombre y proyecto, asegurando que "Gandalf" siempre tenga el mismo ID, sin importar cuÃ¡ntas veces lo escanees.

Advertencias:
â€¢ âš ï¸ Zona de Peligro: La opciÃ³n "Confirmar DestrucciÃ³n" elimina fÃ­sicamente los metadatos de grafos en Firestore. Ãšsala con precauciÃ³n extrema.

--------------------------------------------------------------------------------
5. EL LABORATORIO (Laboratory)
La Promesa: Tu mesa de alquimia. Un espacio para filtrar, etiquetar y chatear con tus archivos de referencia (PDFs, imÃ¡genes, notas) sin contaminar la novela.

MecÃ¡nica Sagrada (CÃ³mo se usa):
1. Filtros: Usa las etiquetas inteligentes (LORE, CIENCIA, VISUAL) para filtrar tus recursos.
2. El Bibliotecario: El chat integrado ("Gemini Flash") tiene acceso exclusivo a los archivos que ves en pantalla. PregÃºntale cosas como "Â¿QuÃ© dice el PDF sobre la gravedad artificial?".
3. Auto-Etiquetado: El sistema intenta clasificar tus archivos nuevos en segundo plano. VerÃ¡s un icono de "Analizando..." mientras ocurre.

La Magia Oculta (Lo TÃ©cnico): El LaboratoryPanel.tsx aplana la estructura de carpetas (flatten(fileTree)) y filtra solo aquellos archivos que viven en rutas designadas como _RESOURCES.
â€¢ ClasificaciÃ³n Perezosa: Usa un debounce de 2 segundos para invocar la funciÃ³n classifyResource en lotes pequeÃ±os (3 archivos a la vez), evitando saturar la cuota de la IA.

Advertencias:
â€¢ âš ï¸ Solo Referencias: El Laboratorio ignora deliberadamente los archivos de tu Manuscrito (Borradores/Saga) para evitar confusiones. Solo ve lo que estÃ¡ en la carpeta de Recursos.

--------------------------------------------------------------------------------
6. EL CRONOGRAMA (Timeline)
La Promesa: El guardiÃ¡n del tiempo. Extrae automÃ¡ticamente eventos y fechas de tu texto para construir una lÃ­nea temporal coherente.

MecÃ¡nica Sagrada (CÃ³mo se usa):
1. ConfiguraciÃ³n: Define el "AÃ±o Actual" y el nombre de la "Era" (ej: 3050, Era GalÃ¡ctica).
2. InvocaciÃ³n: Pulsa "Analizar Archivo" mientras tienes un capÃ­tulo abierto. La IA leerÃ¡ el texto buscando marcadores temporales.
3. CuraciÃ³n: Los eventos aparecen como "Sugeridos" (Amarillo). ConfÃ­rmalos (Verde) o descÃ¡rtalos (Rojo).

La Magia Oculta (Lo TÃ©cnico): Utiliza una extracciÃ³n de doble paso (extractTimelineEvents).
â€¢ Circuit Breaker: Si la seguridad (AppCheck) no estÃ¡ lista, el panel bloquea la escucha de eventos (isSecurityReady check) para proteger la base de datos TDB_Timeline.

Advertencias:
â€¢ âš ï¸ AmbigÃ¼edad: La IA puede confundir "hace diez aÃ±os" si no tiene un contexto claro del "ahora". AsegÃºrate de configurar bien el AÃ±o Actual antes de analizar.

--------------------------------------------------------------------------------
7. LA IMPRENTA (Export Panel)
La Promesa: La materializaciÃ³n final. Compila tus miles de fragmentos dispersos en un Ãºnico manuscrito profesional (PDF) o genera certificados legales de autorÃ­a.

MecÃ¡nica Sagrada (CÃ³mo se usa):
1. ComposiciÃ³n: Selecciona quÃ© carpetas o archivos incluir en el libro usando el Ã¡rbol con casillas de verificaciÃ³n.
2. Metadatos: Rellena TÃ­tulo, Autor y SubtÃ­tulo.
3. Prensado:
    â—¦ Compilar Manuscrito: Genera un PDF legible para lectura o impresiÃ³n.
    â—¦ Certificado de AutorÃ­a: Descarga un informe forense (.pdf, .md, .txt) que demuestra la trazabilidad humana de tu escritura (Logs de AuditorÃ­a).

La Magia Oculta (Lo TÃ©cnico): La funciÃ³n compileManuscript en el backend recibe la lista ordenada de IDs.
â€¢ ReconstrucciÃ³n Binaria: El PDF se genera en la nube (pdfmake) y se devuelve como una cadena Base64. El frontend la decodifica byte a byte (Uint8Array) para crear un Blob descargable, garantizando que el archivo nunca toque un servidor pÃºblico de almacenamiento.

Advertencias:
â€¢ âš ï¸ Tiempo de Prensado: Compilar una novela entera (>50k palabras) puede tardar hasta 30 segundos. No cierres la ventana mientras el icono gira.
